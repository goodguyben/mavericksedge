{
  "name": "RAG Pipelines",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1rP7a--_p5TVL0sl4PMWXpkdnLeyXAKmy",
          "mode": "list",
          "cachedResultName": "RAG",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1rP7a--_p5TVL0sl4PMWXpkdnLeyXAKmy"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -80,
        80
      ],
      "id": "ef939bb8-152c-47d9-9b84-fda001ef5594",
      "name": "Google Drive Trigger",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "V2ewjiHO0o6xhQ2R",
          "name": "nateherk88@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        128,
        80
      ],
      "id": "128764a4-1bca-48bd-b564-92707381f832",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "V2ewjiHO0o6xhQ2R",
          "name": "nateherk88@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        336,
        80
      ],
      "id": "0d57ebbf-cb97-43d5-83e7-28e08eb400af",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "r1eLu64ie9Tz6yOK",
          "name": "Demo 2.22.25"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "fileName",
                "value": "={{ $json.name }}"
              },
              {
                "name": "date",
                "value": "={{ $now }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        464,
        224
      ],
      "id": "7952b53c-e5f9-48ae-b13f-b5213b188bbb",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        224
      ],
      "id": "aee741fc-af47-42b1-bb24-c8b1bc7bc8c2",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "yWkFMwOwuEEU2cnu",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        96,
        -320
      ],
      "id": "3c41f58a-11b5-4600-a9a9-4299177850f3",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -64,
        -320
      ],
      "id": "11821edb-f3db-4d3e-9177-a4614b7f1b7c",
      "name": "When chat message received",
      "webhookId": "60ef0174-4d66-458b-977d-3fcf4094f321"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        80,
        -176
      ],
      "id": "75c999ef-6eac-40ac-9a3f-b5ae832f82b1",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "td3utRybtI5wRRtH",
          "name": "OpenRouter account 2"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Use this to get information from your knowledge base.",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        384,
        -320
      ],
      "id": "58651471-02d4-4607-9fbc-be89758ffa1f",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "r1eLu64ie9Tz6yOK",
          "name": "Demo 2.22.25"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        432,
        -176
      ],
      "id": "59539a57-0107-4f5a-9ff9-b366c704489b",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "yWkFMwOwuEEU2cnu",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1rP7a--_p5TVL0sl4PMWXpkdnLeyXAKmy",
          "mode": "list",
          "cachedResultName": "RAG",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1rP7a--_p5TVL0sl4PMWXpkdnLeyXAKmy"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -80,
        480
      ],
      "id": "e7b25dda-0cc9-49c5-9373-697f946815dc",
      "name": "Google Drive Trigger1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "V2ewjiHO0o6xhQ2R",
          "name": "nateherk88@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>fileName=like.*{{ $json.name }}"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        64,
        480
      ],
      "id": "3b476a4d-5c89-490b-9806-fd0f9529ebcb",
      "name": "Delete a row",
      "credentials": {
        "supabaseApi": {
          "id": "r1eLu64ie9Tz6yOK",
          "name": "Demo 2.22.25"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        352,
        480
      ],
      "id": "2b59392f-05f0-4ee2-bca6-9919fd42ccff",
      "name": "Supabase Vector Store2",
      "credentials": {
        "supabaseApi": {
          "id": "r1eLu64ie9Tz6yOK",
          "name": "Demo 2.22.25"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "fileName",
                "value": "={{ $('Google Drive Trigger1').item.json.name }}"
              },
              {
                "name": "date",
                "value": "={{ $now }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        464,
        640
      ],
      "id": "bf030a5a-1681-4da5-9c89-8af3770583bb",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        640
      ],
      "id": "b7d741f5-547d-481b-93d8-f8ba32329bd5",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "yWkFMwOwuEEU2cnu",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Google Drive Trigger1').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        208,
        480
      ],
      "id": "8994b60b-ff50-444f-9227-21f1019dd20a",
      "name": "Download file1",
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "V2ewjiHO0o6xhQ2R",
          "name": "nateherk88@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1r2Mquv0KFvwzVVsvTb3stzRugQdbDc72",
          "mode": "list",
          "cachedResultName": "Recycling Bin",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1r2Mquv0KFvwzVVsvTb3stzRugQdbDc72"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -64,
        928
      ],
      "id": "2312e75d-7d91-436d-aee6-03af1fc59a3d",
      "name": "Google Drive Trigger2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "V2ewjiHO0o6xhQ2R",
          "name": "nateherk88@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>fileName=like.*{{ $json.name }}"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        128,
        928
      ],
      "id": "ffc31edc-4ce8-482f-9c51-10680c4a3dfb",
      "name": "Delete a row1",
      "credentials": {
        "supabaseApi": {
          "id": "r1eLu64ie9Tz6yOK",
          "name": "Demo 2.22.25"
        }
      }
    },
    {
      "parameters": {
        "content": "# 🛠️ Setup Guide  \n**Author:** [Nate Herk](https://www.youtube.com/@nateherk)\n\nFollow these steps to get the n8n workflow system running smoothly:\n\n### ✅ Step 1: Connect Your Google Drive Credentials  \nMake sure your **Google Drive trigger** is authorized and set to watch the appropriate folder for new file drops.\n\n### ✅ Step 2: Connect Your Supabase Credentials  \nHook up your **Supabase** project so n8n can insert and manage vector data.\n\n### ✅ Step 3: Connect Your Chat & Embeddings Models  \nUse [OpenRouter](https://openrouter.ai/) for flexible model access and [OpenAI](https://platform.openai.com/) for embedding generation.\n\n### ✅ Step 4: Drop a Doc into the Trigger Folder  \nUpload a file into the folder being watched by **Pipeline 1** (new doc trigger). Confirm it’s inserted into Supabase and available to your agents.\n\n### ✅ Step 5: Update the Doc  \nModify the same document. This should trigger **Pipeline 2 (update doc)**, which should:  \n- Remove old rows from Supabase  \n- Insert the new version cleanly\n\n### ✅ Step 6: Move the File to the Recycling Bin  \nDrag the document into the \"recycling bin\" folder. This should trigger **Pipeline 3 (delete doc)** and clean up the corresponding vectors in Supabase.\n\n### 🧪 Final Step: Test and Iterate  \nTry different document types and metadata formats. Make sure your agents can accurately retrieve and respond to your queries.\n",
        "height": 736,
        "width": 1040
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1232,
        -416
      ],
      "id": "ae5fc242-59ab-4d42-9b0f-cdf67147a514",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# RAG Agent",
        "height": 384,
        "width": 880,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -176,
        -416
      ],
      "id": "4a8b4ae8-7247-461d-b8ad-2091d077f220",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Pipeline 1 (Upload Doc)",
        "height": 384,
        "width": 880,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -176,
        -16
      ],
      "id": "4bb93ad8-f324-4c09-ab9a-73a169a1daca",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Pipeline 2 (Update Doc)",
        "height": 384,
        "width": 880,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -176,
        384
      ],
      "id": "9d1d4d8d-8ac9-4f12-8410-bd241e8a1700",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Pipeline 3 (Delete Doc)",
        "height": 384,
        "width": 880,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -176,
        784
      ],
      "id": "a0a4de10-c513-440a-8fc6-fa2a6e33aa64",
      "name": "Sticky Note4"
    }
  ],
  "pinData": {},
  "connections": {
    "Google Drive Trigger": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Trigger1": {
      "main": [
        [
          {
            "node": "Delete a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Delete a row": {
      "main": [
        [
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Trigger2": {
      "main": [
        [
          {
            "node": "Delete a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ef661e2a-5e43-417d-89be-18258362b205",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "95e5a8c2e51c83e33b232ea792bbe3f063c094c33d9806a5565cb31759e1ad39"
  },
  "id": "KOlLeg1r8PQyFar5",
  "tags": []
}